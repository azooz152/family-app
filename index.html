<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AZOOZ TV SPEED</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root { --hilal-blue: #0057b7; --bg: #080808; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        
        body {
            background-image: url('https://raw.githubusercontent.com/azooz152/family-app/main/home.png');
            background-size: cover; background-attachment: fixed; background-color: var(--bg);
            color: white; overflow: hidden; height: 100vh;
        }

        body::before { content: ''; position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.7); z-index: -1; }

        /* شبكة المحتوى - نظام الهولك */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px; padding: 20px;
            height: calc(100vh - 80px); overflow-y: auto;
            scroll-behavior: smooth;
        }

        .card {
            background: #151515; border: 2px solid #222; border-radius: 10px;
            overflow: hidden; transition: 0.2s; cursor: pointer; position: relative;
        }

        .card img { width: 100%; height: 210px; object-fit: cover; background: #000; }

        .card .info {
            padding: 8px; font-size: 13px; text-align: center;
            background: linear-gradient(transparent, rgba(0,0,0,0.9));
            position: absolute; bottom: 0; width: 100%;
        }

        /* سرعة الاستجابة عند الوقوف (Focus) */
        .card:focus, .card:hover {
            transform: scale(1.08); border-color: var(--hilal-blue);
            box-shadow: 0 0 20px var(--hilal-blue); outline: none; z-index: 5;
        }

        /* شاشة التحميل السريع */
        #loader {
            position: fixed; top:0; left:0; width:100%; height:100%; background: #000;
            display: none; justify-content: center; align-items: center; z-index: 100;
        }
    </style>
</head>
<body>

    <div id="loader"><i class="fas fa-spinner fa-spin fa-3x" style="color:var(--hilal-blue)"></i></div>

    <div id="main-ui">
        <div id="home-screen" style="display: flex; justify-content: center; align-items: center; height: 100vh; gap: 20px;">
            <div class="card" tabindex="1" onclick="fetchFast('live')" style="width: 200px; height: 200px; display: flex; flex-direction: column; justify-content: center;">
                <i class="fas fa-tv fa-4x"></i><br><span>بث مباشر</span>
            </div>
            <div class="card" tabindex="2" onclick="fetchFast('movie')" style="width: 200px; height: 200px; display: flex; flex-direction: column; justify-content: center;">
                <i class="fas fa-film fa-4x"></i><br><span>أفلام</span>
            </div>
        </div>

        <div id="list-view" class="grid-container" style="display: none;"></div>
    </div>

<script>
    const CONFIG = {
        host: "http://aseaf1.me:8080",
        user: "292737757579",
        pass: "196384823579"
    };

    // مخزن البيانات لسرعة الاسترجاع
    let cache = {};

    async function fetchFast(type) {
        const loader = document.getElementById('loader');
        const listView = document.getElementById('list-view');
        const home = document.getElementById('home-screen');
        
        loader.style.display = 'flex';
        
        // إذا كانت البيانات موجودة مسبقاً، اعرضها فوراً (سرعة صفر ثانية)
        if (cache[type]) {
            render(cache[type], type);
            return;
        }

        const action = type === 'live' ? 'get_live_streams' : 'get_vod_streams';
        const url = `${CONFIG.host}/player_api.php?username=${CONFIG.user}&password=${CONFIG.pass}&action=${action}`;
        
        try {
            const res = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`);
            const data = await res.json();
            cache[type] = data; // تخزين في الذاكرة
            render(data, type);
        } catch (e) { alert("تأكد من اتصالك بالإنترنت"); }
    }

    function render(data, type) {
        const container = document.getElementById('list-view');
        document.getElementById('home-screen').style.display = 'none';
        container.style.display = 'grid';
        container.innerHTML = '';
        
        // تقليل وقت الرسم (فقط أول 100 عنصر للسرعة)
        const fastData = data.slice(0, 150);

        fastData.forEach(item => {
            const div = document.createElement('div');
            div.className = 'card';
            div.tabIndex = 0;
            const img = item.stream_icon || 'https://raw.githubusercontent.com/azooz152/family-app/main/home.png';
            
            div.innerHTML = `
                <img src="${img}" loading="lazy">
                <div class="info">${item.name}</div>
            `;

            div.onclick = () => {
                const streamUrl = `${CONFIG.host}/${type}/${CONFIG.user}/${CONFIG.pass}/${item.stream_id}.ts`;
                if (window.AppInventor) window.AppInventor.setWebViewString(streamUrl);
            };
            container.appendChild(div);
        });
        
        document.getElementById('loader').style.display = 'none';
        container.firstChild.focus();
    }
</script>
</body>
</html>
